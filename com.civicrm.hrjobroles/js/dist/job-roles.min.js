/*!
angular-xeditable - 0.1.8
Edit-in-place for angular.js
Build date: 2014-01-10 
*/

/**
 * Bunch of useful filters for angularJS(with no external dependencies!)
 * @version v0.5.4 - 2015-02-20 * @link https://github.com/a8m/angular-filter
 * @author Ariel Mashraki <ariel@mashraki.co.il>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

define("job-roles/modules/job-roles.config",["common/angular"],function(e){"use strict";function t(e,t,n,r,a){t.debugEnabled(a.debug),r.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).when("/",{templateUrl:a.pathBaseUrl+a.pathTpl+"mainTemplate.html?v=1",resolve:{},controller:"JobRolesController",controllerAs:"jobroles"}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}e.module("hrjobroles.config",["hrjobroles.constants"]).config(t),t.$inject=["$httpProvider","$logProvider","$resourceProvider","$routeProvider","settings"]}),define("job-roles/modules/job-roles.constants",["common/angular"],function(e){"use strict";e.module("hrjobroles.constants",[]).constant("settings",{classNamePrefix:"hrjobroles-",contactId:decodeURIComponent((new RegExp("[?|&]cid=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null,debug:!0,pathApp:CRM.vars.hrjobroles.path,pathRest:CRM.url("civicrm/ajax/rest"),pathBaseUrl:CRM.vars.hrjobroles.baseURL+"/",pathTpl:"views/",pathIncludeTpl:"views/include/"})}),define("job-roles/controllers/job-roles.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function r(r,a,o,i,s,l,u,c,d,f,m,p,b,h,v,g){function _(e,t){"undefined"==typeof we.editData[e]&&(we.editData[e]={}),"cost_centre"===t?("undefined"!=typeof we.editData[e].cost_centers&&we.editData[e].cost_centers instanceof Array||(we.editData[e].cost_centers=[]),we.editData[e].cost_centers.push({id:we.editData[e].cost_centers.length+1,cost_centre_id:"",type:"1",percentage:"0",amount:"0"})):("undefined"!=typeof we.editData[e].funders&&we.editData[e].funders instanceof Array||(we.editData[e].funders=[]),we.editData[e].funders.push({id:we.editData[e].funders.length+1,funder_id:"",type:"1",percentage:"0",amount:"0"}))}function $(){we.add_new=!0}function y(){we.add_new=!1,delete we.editData.new_role_id}function w(e,t){we.viewTab[e]=t}function D(t,n){P(t)&&(t=null),P(n)&&(n=null);var r=!0;return!!t&&(e.forEach(we.contractsData,function(e){ge(t)===ge(e.start_date)&&ge(n)===ge(e.end_date)&&(r=!1)}),r)}function E(){return"undefined"==typeof we.editData.new_role_id||"undefined"==typeof we.editData.new_role_id.title||""===we.editData.new_role_id.title||"undefined"==typeof we.editData.new_role_id.job_contract_id||""===we.editData.new_role_id.job_contract_id}function j(e){we.collapsedRows[e]=!we.collapsedRows[e]}function C(e){return v.getContracts(e).then(function(e){for(var t=[],n={},r=0;r<e.count;r++){t.push(e.values[r].id);var a={id:e.values[r].id,title:e.values[r].title,start_date:e.values[r].period_start_date,end_date:e.values[r].period_end_date,status:status,is_current:e.values[r].is_current,revisions:e.values[r].revisions},o=ge(a.end_date)||"Unspecified";a.label=a.title+" ("+ge(a.start_date)+" - "+o+")",n[e.values[r].id]=a}return we.contractsData=n,we.job_contract_ids=t,t},function(e){we.error=e})}function R(e){var t=ge(e,"YYYY-MM-DD");return"Unspecified"!==t?t:null}function T(e){return v.createJobRole(e).then(function(e){return e},function(e){we.error=e})}function F(e,t,n){"cost_centre"===t?we.editData[e].cost_centers.splice(n,1):we.editData[e].funders.splice(n,1)}function x(e){return v.deleteJobRole(e).then(function(e){return e},function(e){we.error=e})}function A(e){e.preventDefault(),e.stopPropagation(),we.picker.opened=!0}function S(){return t(we.presentJobRoles.concat(we.pastJobRoles)).map(function(e){return e.funder}).thru(function(e){return e.join("").split("|")}).compact().uniq().value()}function N(e,t){we.editData.hasOwnProperty(e)&&("funders"===t&&(we.editData[e][t]=h.issetFunder(we.editData[e][t])),"cost_centers"===t&&(we.editData[e][t]=h.issetCostCentre(we.editData[e][t])))}function O(e,t,n){n=n||{start:"start_date",end:"end_date"},e[n.start]=t.start?ge(t.start,Date):null,e[n.end]=t.end?ge(t.end,Date):null}function k(e){var t=function(e){var t=[],n=0;if(1===e.is_error)we.message_type="alert-danger",we.message="Cannot get contact list!";else{for(;n<e.count;n++)t.push({id:e.values[n].id,sort_name:e.values[n].sort_name});we.contactList=t}c(function(){we.message=null},3e3)},n=function(e){we.error=e};return v.getContactList(e).then(t,n)}function J(e){return we.contractsData[e]}function L(t){var n="";return e.forEach(we.CostCentreList,function(e,r){+e.id===+t&&(n=e.title)}),n}function U(){return v.getContactList(null,S()).then(function(e){return t(e.values).map(function(e){return e}).indexBy("contact_id").value()})}function M(e){var t;return t=we.job_contract_ids?o.when(we.job_contract_ids):C(e),t.then(function(e){return!!e.length&&te(e)})}function I(){var t=["hrjc_department","hrjc_region","hrjc_location","hrjc_level_type","cost_centres"];return v.getOptionValues(t).then(function(t){if(1===t.is_error)we.message_type="alert-danger",we.message="Cannot get option values!";else{var n={},r={},a={},o={},i=[];e.forEach(t.optionGroupData,function(e,s){for(var l=0;l<t.count;l++)switch(s){case"hrjc_department":e===t.values[l].option_group_id&&(n[t.values[l].value]={id:t.values[l].id,title:t.values[l].label,value:t.values[l].value,is_active:t.values[l].is_active});break;case"hrjc_region":e===t.values[l].option_group_id&&(r[t.values[l].value]={id:t.values[l].id,title:t.values[l].label,value:t.values[l].value,is_active:t.values[l].is_active});break;case"hrjc_location":e===t.values[l].option_group_id&&(a[t.values[l].value]={id:t.values[l].id,title:t.values[l].label,value:t.values[l].value,is_active:t.values[l].is_active});break;case"hrjc_level_type":e===t.values[l].option_group_id&&(o[t.values[l].value]={id:t.values[l].id,title:t.values[l].label,value:t.values[l].value,is_active:t.values[l].is_active});break;case"cost_centres":e===t.values[l].option_group_id&&i.push({id:t.values[l].id,title:t.values[l].label,is_active:t.values[l].is_active,weight:t.values[l].weight})}}),we.DepartmentsData=$e(n),we.RegionsData=$e(r),we.LocationsData=$e(a),we.LevelsData=$e(o),we.CostCentreList=i,we.message_type="alert-success",we.message=null}c(function(){we.message=null},3e3)},function(e){we.error=e})}function q(e,t){e.cost_centers=[];for(var n=h.isNotUndefined(t.cost_center.split("|")),r=t.cost_center_val_type.split("|"),a=t.percent_pay_cost_center.split("|"),o=t.amount_pay_cost_center.split("|"),i=0;i<n.length;i++)""!==n[i]&&e.cost_centers.push({id:e.cost_centers.length+1,amount:o[i],cost_centre_id:n[i],percentage:a[i],type:r[i]})}function B(e,t,n){"undefined"==typeof we.editData[e]&&(we.editData[e]={}),"funders"===t?z(we.editData[e],n):"cost_centers"===t?q(we.editData[e],n):W(we.editData[e],t,n),"end_date"!==t||we.editData[e].end_date||(we.editData[e].end_date=null),we.editData[e].job_contract_id&&we.editData[e].start_date&&"undefined"!=typeof we.editData[e].end_date&&("start_date"===t||"job_contract_id"===t||"end_date"===t)&&pe(e)}function z(e,t){e.funders=[];for(var n=h.isNotUndefined(t.funder.split("|")),r=t.funder_val_type.split("|"),a=t.percent_pay_funder.split("|"),o=t.amount_pay_funder.split("|"),i=0;i<n.length;i++)""!==n[i]&&e.funders.push({id:e.funders.length+1,amount:o[i],percentage:a[i],type:r[i],funder_id:{id:n[i],sort_name:_e[n[i]].sort_name}})}function W(e,t,r){var a="undefined"==typeof e.start_date||"undefined"==typeof e.job_contract_id;if(e[t]=r,e.start_date){var o=n(e.start_date),i=isNaN(o)&&"undefined"!=typeof e.start_date,s=!("undefined"==typeof e.job_contract_id);i&&s&&a?we.onContractEdited(null,role_id).then(function(){return u.$apply(),we.updateRole(role_id)}):O(e,{start:e.start_date,end:e.end_date})}}function H(e){return!!we.editData[e].is_edit}function P(e){return null===e}function V(e){return!!we.CalendarShow[e]}function Y(e){return!!we.collapsedRows[e]}function G(e,t){return+we.viewTab[e]===+t}function K(e,t){N(e,t)}function Z(e,t){"both"===t?ye.map(function(t){N(e,t)}):N(e,t)}function X(e,t){var n=e||we.editData[t].job_contract_id,r=J(n),a=we.checkIfDatesAreCustom(we.editData[t].start_date,we.editData[t].end_date);return void 0===r?(we.editData[t].job_contract_id=void 0,we.editData[t].start_date=void 0,we.editData[t].end_date=void 0,!1):void(a?O(we.editData[t],{start:we.editData[t].start_date,end:we.editData[t].end_date}):O(we.editData[t],{start:r.start_date,end:r.end_date}))}function Q(){var e=J(we.editData.new_role_id.job_contract_id),t=we.checkIfDatesAreCustom(we.editData.new_role_id.newStartDate,we.editData.new_role_id.newEndDate);void 0===e?(we.editData.new_role_id.job_contract_id=void 0,we.editData.new_role_id.newStartDate=void 0,we.editData.new_role_id.newEndDate=void 0):O(we.editData.new_role_id,{start:t?we.editData.new_role_id.newStartDate:e.start_date,end:t?we.editData.new_role_id.newEndDate:e.end_date},{start:"newStartDate",end:"newEndDate"})}function ee(e){we.CalendarShow[e]=!0}function te(e){return v.getAllJobRoles(e).then(function(e){we.presentJobRoles=[],we.pastJobRoles=[],we.status="Data load OK",1===e.is_error&&(we.error="Data load failure"),e.values.forEach(function(e){var t=n().startOf("day"),r=null;P(e.end_date)||(r=n(e.end_date).startOf("day")),!r||r.isSameOrAfter(t)?we.presentJobRoles.push(e):we.pastJobRoles.push(e)})}).then(function(){return U()}).then(function(e){_e=e}).catch(function(e){we.error=e})}function ne(e){a.debug("Remove Role");var t=d.open({appendTo:i.find("div").eq(0),template:"",templateUrl:m.pathApp+"views/modalDialog.html?v="+(new Date).getTime(),size:"sm",controller:"ModalDialogController",controllerAs:"dialog",resolve:{content:function(){return{copyCancel:"No",title:"Alert",msg:"Are you sure you want to Delete Job Role?"}}}});t.result.then(function(t){t&&x(e.id).then(function(){return de(e),g.publish("JobRole::deleted"),M(we.contactId)})})}function re(){var t;a.debug("Add New Role"),we.errors={},we.errors.newStartDate=[],we.errors.newEndDate=[];var n=J(we.editData.new_role_id.job_contract_id),r=be({start:we.editData.new_role_id.newStartDate,end:we.editData.new_role_id.newEndDate,contractStart:n.start_date,contractEnd:n.end_date},{start:we.errors.newStartDate,end:we.errors.newEndDate});r&&(t=e.copy(we.editData.new_role_id),t.newStartDate=R(t.newStartDate),t.newEndDate?t.newEndDate=R(t.newEndDate):delete t.newEndDate,t.funders&&t.funders.length&&ce(t.funders),T(t).then(function(){return de(t),g.publish("JobRole::created"),we.add_new=!1,delete we.editData.new_role_id,M(we.contactId)}))}function ae(e){we.CalendarShow[e]=!1}function oe(e){var t="";return"undefined"!=typeof e.type?(t=we.rowTypes[e.type],t.name):"Not set"}function ie(e){we.editData[e].is_edit=!0}function se(){g.subscribe("contract:created",function(e){C(e)}),g.subscribe("contract:deleted",function(e){C(e.contactId).then(function(e){return e.length?te(e):(we.presentJobRoles=[],void(we.pastJobRoles=[]))})})}function le(){we.CalendarShow.newStartDate=!1,we.CalendarShow.newEndDate=!1,we.CalendarShow.start_date=!1,we.CalendarShow.end_date=!1}function ue(e,t,n,r){"cost_centre"===t?we.editData[e].cost_centers[n].type=r:we.editData[e].funders[n].type=r}function ce(e){e.forEach(function(e){var n=e.funder_id;t.contains(Object.keys(_e),n.id)||(_e[n.id]=n)})}function de(e){we.contractsData[e.job_contract_id].is_current&&v.getCurrentDepartments(e.job_contract_id).then(function(e){f("updateContactHeader",{roles:{departments:e}})})}function fe(e,t){return v.updateJobRole(e,t).then(function(e){return e},function(e){we.error=e})}function me(t,n){var r;a.debug("Update Role"),"string"==typeof n&&N(t,n),r=e.copy(we.editData[t]),r.location=void 0===r.location?r.location="":r.location,r.level=void 0===r.level?r.level="":r.level,r.department=void 0===r.department?r.department="":r.department,r.region=void 0===r.region?r.region="":r.region,r.start_date=R(r.start_date),r.end_date?r.end_date=R(r.end_date):delete r.end_date,r.funders&&r.funders.length&&ce(r.funders),fe(t,r).then(function(){return de(r),g.publish("JobRole::updated"),M(we.contactId)})}function pe(e){var t=we.editData[e].job_contract_id;if(we.checkIfDatesAreCustom(we.editData[e].start_date,we.editData[e].end_date)){var n=J(t),r=n.revisions.some(function(t){return t.period_start_date===ge(we.editData[e].start_date)&&t.period_end_date===ge(we.editData[e].end_date)});r&&(O(we.editData[e],{start:n.start_date,end:n.end_date}),we.updateRole(e))}else O(we.editData[e],{start:we.editData[e].start_date,end:we.editData[e].end_date})}function be(e,t){var n=0;return b.setErrorCallback(function(e,r){n++,r.indexOf("start_date")>-1&&t.start.push(e),r.indexOf("end_date")>-1&&t.end.push(e)}),b.validate(e.start,e.end,e.contractStart,e.contractEnd),0===n}function he(e){e.start_date.$error.custom=[],e.end_date.$error.custom=[];var t=J(e.contract.$viewValue);if("undefined"==typeof t)return"Contract is missing";var n=be({start:e.start_date.$viewValue,end:e.end_date.$viewValue,contractStart:t.start_date,contractEnd:t.end_date},{start:e.start_date.$error.custom,end:e.end_date.$error.custom});return!!n||"Error"}function ve(e){if("title"===e||" "===e)return"Title cannot be title!"}a.debug("Controller: JobRolesController");var ge=r("formatDate"),_e={},$e=r("getActiveValues"),ye=["funders","cost_centers"],we=this;we.contactId=m.contactId,we.format=p.DATE_FORMAT,we.loading=!0,we.pastJobRoles=[],we.presentJobRoles=[],we.collapsedRows=[],we.contactList=[],we.editData={},we.viewTab=[],we.CalendarShow=[],we.contractsData=[],we.DepartmentsData={},we.LevelsData={},we.LocationsData={},we.RegionsData={},we.addNewRoleUrl=m.pathBaseUrl+m.pathIncludeTpl+"add_new_role.html",we.jobRolePanelUrl=m.pathBaseUrl+m.pathIncludeTpl+"job_role_panel.html",we.rowTypes={},we.rowTypes[0]={id:0,name:"Fixed"},we.rowTypes[1]={id:1,name:"%"},we.addAdditionalRow=_,we.addNewRole=$,we.cancelNewRole=y,we.changeTab=w,we.checkIfDatesAreCustom=D,we.checkNewRole=E,we.collapseRow=j,we.deleteAdditionalRow=F,we.dpOpen=A,we.getContactList=k,we.getCostLabel=L,we.initData=B,we.isChanged=H,we.isOpen=V,we.isRowCollapsed=Y,we.isTab=G,we.onAfterSave=K,we.onCancel=Z,we.onContractEdited=X,we.onContractSelected=Q,we.open=ee,we.removeRole=ne,we.saveNewRole=re,we.select=ae,we.showRowType=oe,we.showSave=ie,we.today=le,we.updateAdditionalRowType=ue,we.updateRole=me,we.validateRole=he,we.validateTitle=ve,function(){se(),we.today(),o.all([I(),M(we.contactId),we.getContactList()]).then(function(){we.loading=!1})}()}return r.__name="JobRolesController",r.$inject=["$filter","$log","$q","$rootElement","$route","$routeParams","$scope","$timeout","$uibModal","DOMEventTrigger","settings","HR_settings","dateValidation","filtersService","jobRoleService","pubSub"],r}),define("job-roles/controllers/modal-dialog.controller",[],function(){"use strict";function e(e,t,n,r){function a(){e.dismiss("Cancel")}function o(t){e.close(t||!0)}t.debug("Controller: ModalDialogController");var i=this;i.copyCancel=r.copyCancel||"Cancel",i.copyConfirm=r.copyConfirm||"Yes",i.msg=r.msg||"",i.title=r.title||"CiviHR Job Roles",i.cancel=a,i.confirm=o}return e.__name="ModalDialogController",e.$inject=["$uibModalInstance","$log","$timeout","content"],e}),define("job-roles/modules/job-roles.controllers",["common/angular","job-roles/controllers/job-roles.controller","job-roles/controllers/modal-dialog.controller"],function(e,t,n){"use strict";return e.module("hrjobroles.controllers",[]).controller(t.__name,t).controller(n.__name,n)}),angular.module("xeditable",[]).value("editableOptions",{theme:"default",buttons:"right",blurElem:"cancel",blurForm:"ignore",activate:"focus"}),angular.module("xeditable").directive("editableBsdate",["editableDirectiveFactory",function(e){return e({directiveName:"editableBsdate",inputTpl:'<input type="text">'})}]),angular.module("xeditable").directive("editableBstime",["editableDirectiveFactory",function(e){return e({directiveName:"editableBstime",inputTpl:"<timepicker></timepicker>",render:function(){this.parent.render.call(this);var e=angular.element('<div class="well well-small" style="display:inline-block;"></div>');e.attr("ng-model",this.inputEl.attr("ng-model")),this.inputEl.removeAttr("ng-model"),this.attrs.eNgChange&&(e.attr("ng-change",this.inputEl.attr("ng-change")),this.inputEl.removeAttr("ng-change")),this.inputEl.wrap(e)}})}]),angular.module("xeditable").directive("editableCheckbox",["editableDirectiveFactory",function(e){return e({directiveName:"editableCheckbox",inputTpl:'<input type="checkbox">',render:function(){this.parent.render.call(this),this.attrs.eTitle&&(this.inputEl.wrap("<label></label>"),this.inputEl.after(angular.element("<span></span>").text(this.attrs.eTitle)))},autosubmit:function(){var e=this;e.inputEl.bind("change",function(){setTimeout(function(){e.scope.$apply(function(){e.scope.$form.$submit()})},500)})}})}]),angular.module("xeditable").directive("editableChecklist",["editableDirectiveFactory","editableNgOptionsParser",function(e,t){return e({directiveName:"editableChecklist",inputTpl:"<span></span>",useCopy:!0,render:function(){this.parent.render.call(this);var e=t(this.attrs.eNgOptions),n='<label ng-repeat="'+e.ngRepeat+'"><input type="checkbox" checklist-model="$parent.$data" checklist-value="'+e.locals.valueFn+'"><span ng-bind="'+e.locals.displayFn+'"></span></label>';this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("ng-options"),this.inputEl.html(n)}})}]),function(){var e="text|email|tel|number|url|search|color|date|datetime|time|month|week".split("|");angular.forEach(e,function(e){var t="editable"+e.charAt(0).toUpperCase()+e.slice(1);angular.module("xeditable").directive(t,["editableDirectiveFactory",function(n){return n({directiveName:t,inputTpl:'<input type="'+e+'">'})}])}),angular.module("xeditable").directive("editableRange",["editableDirectiveFactory",function(e){return e({directiveName:"editableRange",inputTpl:'<input type="range" id="range" name="range">',render:function(){this.parent.render.call(this),this.inputEl.after("<output>{{$data}}</output>")}})}])}(),angular.module("xeditable").directive("editableRadiolist",["editableDirectiveFactory","editableNgOptionsParser",function(e,t){return e({directiveName:"editableRadiolist",inputTpl:"<span></span>",render:function(){this.parent.render.call(this);var e=t(this.attrs.eNgOptions),n='<label ng-repeat="'+e.ngRepeat+'"><input type="radio" ng-model="$parent.$data" value="{{'+e.locals.valueFn+'}}"><span ng-bind="'+e.locals.displayFn+'"></span></label>';this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("ng-options"),this.inputEl.html(n)},autosubmit:function(){var e=this;e.inputEl.bind("change",function(){setTimeout(function(){e.scope.$apply(function(){e.scope.$form.$submit()})},500)})}})}]),angular.module("xeditable").directive("editableSelect",["editableDirectiveFactory",function(e){return e({directiveName:"editableSelect",inputTpl:"<select></select>",autosubmit:function(){var e=this;e.inputEl.bind("change",function(){e.scope.$apply(function(){e.scope.$form.$submit()})})}})}]),angular.module("xeditable").directive("editableTextarea",["editableDirectiveFactory",function(e){return e({directiveName:"editableTextarea",inputTpl:"<textarea></textarea>",addListeners:function(){var e=this;e.parent.addListeners.call(e),e.single&&"no"!==e.buttons&&e.autosubmit()},autosubmit:function(){var e=this;e.inputEl.bind("keydown",function(t){(t.ctrlKey||t.metaKey)&&13===t.keyCode&&e.scope.$apply(function(){e.scope.$form.$submit()})})}})}]),angular.module("xeditable").factory("editableController",["$q","editableUtils",function(e,t){function n(e,n,r,a,o,i,s,l,u){var c,d,f=this;f.scope=e,f.elem=r,f.attrs=n,f.inputEl=null,f.editorEl=null,f.single=!0,f.error="",f.theme=o[i.theme]||o.default,f.parent={},f.inputTpl="",f.directiveName="",f.useCopy=!1,f.single=null,f.buttons="right",f.init=function(t){if(f.single=t,f.name=n.eName||n[f.directiveName],!n[f.directiveName])throw"You should provide value for `"+f.directiveName+"` in editable element!";c=a(n[f.directiveName]),f.buttons=f.single?f.attrs.buttons||i.buttons:"no",n.eName&&f.scope.$watch("$data",function(e){f.scope.$form.$data[n.eName]=e}),n.onshow&&(f.onshow=function(){return f.catchError(a(n.onshow)(e))}),n.onhide&&(f.onhide=function(){return a(n.onhide)(e)}),n.oncancel&&(f.oncancel=function(){return a(n.oncancel)(e)}),n.onbeforesave&&(f.onbeforesave=function(){return f.catchError(a(n.onbeforesave)(e))}),n.onaftersave&&(f.onaftersave=function(){return f.catchError(a(n.onaftersave)(e))}),e.$parent.$watch(n[f.directiveName],function(){f.handleEmpty()})},f.render=function(){var e=f.theme;f.inputEl=angular.element(f.inputTpl),f.controlsEl=angular.element(e.controlsTpl),f.controlsEl.append(f.inputEl),"no"!==f.buttons&&(f.buttonsEl=angular.element(e.buttonsTpl),f.submitEl=angular.element(e.submitTpl),f.cancelEl=angular.element(e.cancelTpl),f.buttonsEl.append(f.submitEl).append(f.cancelEl),f.controlsEl.append(f.buttonsEl),f.inputEl.addClass("editable-has-buttons")),f.errorEl=angular.element(e.errorTpl),f.controlsEl.append(f.errorEl),f.editorEl=angular.element(f.single?e.formTpl:e.noformTpl),f.editorEl.append(f.controlsEl);for(var r in n.$attr)if(!(r.length<=1)){var a=!1,o=r.substring(1,2);if("e"===r.substring(0,1)&&o===o.toUpperCase()&&(a=r.substring(1),"Form"!==a&&"NgSubmit"!==a)){a=a.substring(0,1).toLowerCase()+t.camelToDash(a.substring(1));var s=""===n[r]?a:n[r];f.inputEl.attr(a,s)}}f.inputEl.addClass("editable-input"),f.inputEl.attr("ng-model","$data"),f.editorEl.addClass(t.camelToDash(f.directiveName)),f.single&&(f.editorEl.attr("editable-form","$form"),f.editorEl.attr("blur",f.attrs.blur||("no"===f.buttons?"cancel":i.blurElem))),angular.isFunction(e.postrender)&&e.postrender.call(f)},f.setLocalValue=function(){f.scope.$data=f.useCopy?angular.copy(c(e.$parent)):c(e.$parent)},f.show=function(){return f.setLocalValue(),f.render(),r.after(f.editorEl),l(f.editorEl)(e),f.addListeners(),r.addClass("editable-hide"),f.onshow()},f.hide=function(){return f.editorEl.remove(),r.removeClass("editable-hide"),f.onhide()},f.cancel=function(){f.oncancel()},f.addListeners=function(){f.inputEl.bind("keyup",function(e){if(f.single)switch(e.keyCode){case 27:f.scope.$apply(function(){f.scope.$form.$cancel()})}}),f.single&&"no"===f.buttons&&f.autosubmit(),f.editorEl.bind("click",function(e){1===e.which&&f.scope.$form.$visible&&(f.scope.$form._clicked=!0)})},f.setWaiting=function(e){e?(d=!f.inputEl.attr("disabled")&&!f.inputEl.attr("ng-disabled")&&!f.inputEl.attr("ng-enabled"),d&&(f.inputEl.attr("disabled","disabled"),f.buttonsEl&&f.buttonsEl.find("button").attr("disabled","disabled"))):d&&(f.inputEl.removeAttr("disabled"),f.buttonsEl&&f.buttonsEl.find("button").removeAttr("disabled"))},f.activate=function(){setTimeout(function(){var e=f.inputEl[0];"focus"===i.activate&&e.focus&&e.focus(),"select"===i.activate&&e.select&&e.select()},0)},f.setError=function(t){angular.isObject(t)||(e.$error=t,f.error=t)},f.catchError=function(e,t){return angular.isObject(e)&&t!==!0?u.when(e).then(angular.bind(this,function(e){this.catchError(e,!0)}),angular.bind(this,function(e){this.catchError(e,!0)})):t&&angular.isObject(e)&&e.status&&200!==e.status&&e.data&&angular.isString(e.data)?(this.setError(e.data),e=e.data):angular.isString(e)&&this.setError(e),e},f.save=function(){c.assign(e.$parent,angular.copy(f.scope.$data))},f.handleEmpty=function(){var t=c(e.$parent),n=null===t||void 0===t||""===t||angular.isArray(t)&&0===t.length;r.toggleClass("editable-empty",n)},f.autosubmit=angular.noop,f.onshow=angular.noop,f.onhide=angular.noop,f.oncancel=angular.noop,f.onbeforesave=angular.noop,f.onaftersave=angular.noop}return n.$inject=["$scope","$attrs","$element","$parse","editableThemes","editableOptions","$rootScope","$compile","$q"],n}]),angular.module("xeditable").factory("editableDirectiveFactory",["$parse","$compile","editableThemes","$rootScope","$document","editableController","editableFormController",function(e,t,n,r,a,o,i){return function(t){return{restrict:"A",scope:!0,require:[t.directiveName,"?^form"],controller:o,link:function(n,o,s,l){var u,c=l[0],d=!1;if(l[1])u=l[1],d=!0;else if(s.eForm){var f=e(s.eForm)(n);if(f)u=f,d=!0;else for(var m=0;m<a[0].forms.length;m++)if(a[0].forms[m].name===s.eForm){u=null,d=!0;break}}if(angular.forEach(t,function(e,t){void 0!==c[t]&&(c.parent[t]=c[t])}),angular.extend(c,t),c.init(!d),n.$editable=c,o.addClass("editable"),d)if(u){if(n.$form=u,!n.$form.$addEditable)throw"Form with editable elements should have `editable-form` attribute.";n.$form.$addEditable(c)}else r.$$editableBuffer=r.$$editableBuffer||{},r.$$editableBuffer[s.eForm]=r.$$editableBuffer[s.eForm]||[],r.$$editableBuffer[s.eForm].push(c),n.$form=null;else n.$form=i(),n.$form.$addEditable(c),s.eForm&&(n.$parent[s.eForm]=n.$form),s.eForm||(o.addClass("editable-click"),o.bind("click",function(e){e.preventDefault(),e.editable=c,n.$apply(function(){n.$form.$show()})}))}}}}]),angular.module("xeditable").factory("editableFormController",["$parse","$document","$rootScope","editablePromiseCollection","editableUtils",function(e,t,n,r,a){var o=[];t.bind("click",function(e){if(1===e.which){for(var t=[],r=[],a=0;a<o.length;a++)o[a]._clicked?o[a]._clicked=!1:o[a].$waiting||("cancel"===o[a]._blur&&t.push(o[a]),"submit"===o[a]._blur&&r.push(o[a]));(t.length||r.length)&&n.$apply(function(){angular.forEach(t,function(e){e.$cancel()}),angular.forEach(r,function(e){e.$submit()})})}});var i={$addEditable:function(e){this.$editables.push(e),e.elem.bind("$destroy",angular.bind(this,this.$removeEditable,e)),e.scope.$form||(e.scope.$form=this),this.$visible&&e.catchError(e.show())},$removeEditable:function(e){for(var t=0;t<this.$editables.length;t++)if(this.$editables[t]===e)return void this.$editables.splice(t,1)},$show:function(){if(!this.$visible){this.$visible=!0;var e=r();e.when(this.$onshow()),this.$setError(null,""),angular.forEach(this.$editables,function(t){e.when(t.show())}),e.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,this.$activate),onFalse:angular.bind(this,this.$activate),onString:angular.bind(this,this.$activate)}),setTimeout(angular.bind(this,function(){this._clicked=!1,-1===a.indexOf(o,this)&&o.push(this)}),0)}},$activate:function(e){var t;if(this.$editables.length){if(angular.isString(e))for(t=0;t<this.$editables.length;t++)if(this.$editables[t].name===e)return void this.$editables[t].activate();for(t=0;t<this.$editables.length;t++)if(this.$editables[t].error)return void this.$editables[t].activate();this.$editables[0].activate()}},$hide:function(){this.$visible&&(this.$visible=!1,this.$onhide(),angular.forEach(this.$editables,function(e){e.hide()}),a.arrayRemove(o,this))},$cancel:function(){this.$visible&&(this.$oncancel(),angular.forEach(this.$editables,function(e){e.cancel()}),this.$hide())},$setWaiting:function(e){this.$waiting=!!e,angular.forEach(this.$editables,function(t){t.setWaiting(!!e)})},$setError:function(e,t){angular.forEach(this.$editables,function(n){e&&n.name!==e||n.setError(t)})},$submit:function(){function e(e){var t=r();t.when(this.$onbeforesave()),t.then({onWait:angular.bind(this,this.$setWaiting),onTrue:e?angular.bind(this,this.$save):angular.bind(this,this.$hide),onFalse:angular.bind(this,this.$hide),onString:angular.bind(this,this.$activate)})}if(!this.$waiting){this.$setError(null,"");var t=r();angular.forEach(this.$editables,function(e){t.when(e.onbeforesave())}),t.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,e,!0),onFalse:angular.bind(this,e,!1),onString:angular.bind(this,this.$activate)})}},$save:function(){angular.forEach(this.$editables,function(e){e.save()});var e=r();e.when(this.$onaftersave()),angular.forEach(this.$editables,function(t){e.when(t.onaftersave())}),e.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,this.$hide),onFalse:angular.bind(this,this.$hide),onString:angular.bind(this,this.$activate)})},$onshow:angular.noop,$oncancel:angular.noop,$onhide:angular.noop,$onbeforesave:angular.noop,$onaftersave:angular.noop};return function(){return angular.extend({$editables:[],$visible:!1,$waiting:!1,$data:{},_clicked:!1,_blur:null},i)}}]),angular.module("xeditable").directive("editableForm",["$rootScope","$parse","editableFormController","editableOptions",function(e,t,n,r){return{restrict:"A",require:["form"],compile:function(){return{pre:function(t,r,a,o){var i,s=o[0];a.editableForm?t[a.editableForm]&&t[a.editableForm].$show?(i=t[a.editableForm],angular.extend(s,i)):(i=n(),t[a.editableForm]=i,angular.extend(i,s)):(i=n(),angular.extend(s,i));var l=e.$$editableBuffer,u=s.$name;u&&l&&l[u]&&(angular.forEach(l[u],function(e){i.$addEditable(e)}),delete l[u])},post:function(e,n,a,o){var i;i=a.editableForm&&e[a.editableForm]&&e[a.editableForm].$show?e[a.editableForm]:o[0],a.onshow&&(i.$onshow=angular.bind(i,t(a.onshow),e)),a.onhide&&(i.$onhide=angular.bind(i,t(a.onhide),e)),a.oncancel&&(i.$oncancel=angular.bind(i,t(a.oncancel),e)),a.shown&&t(a.shown)(e)&&i.$show(),i._blur=a.blur||r.blurForm,a.ngSubmit||a.submit||(a.onbeforesave&&(i.$onbeforesave=function(){return t(a.onbeforesave)(e,{$data:i.$data})}),a.onaftersave&&(i.$onaftersave=function(){return t(a.onaftersave)(e,{$data:i.$data})}),n.bind("submit",function(t){t.preventDefault(),e.$apply(function(){i.$submit()})})),n.bind("click",function(e){1===e.which&&i.$visible&&(i._clicked=!0)})}}}}}]),angular.module("xeditable").factory("editablePromiseCollection",["$q",function(e){function t(){return{promises:[],hasFalse:!1,hasString:!1,when:function(t,n){if(t===!1)this.hasFalse=!0;else if(!n&&angular.isObject(t))this.promises.push(e.when(t));else{if(!angular.isString(t))return;this.hasString=!0}},then:function(t){function n(){s.hasString||s.hasFalse?!s.hasString&&s.hasFalse?a():o():r()}t=t||{};var r=t.onTrue||angular.noop,a=t.onFalse||angular.noop,o=t.onString||angular.noop,i=t.onWait||angular.noop,s=this;this.promises.length?(i(!0),e.all(this.promises).then(function(e){i(!1),angular.forEach(e,function(e){s.when(e,!0)}),n()},function(){i(!1),o()})):n()}}}return t}]),angular.module("xeditable").factory("editableUtils",[function(){return{indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1},arrayRemove:function(e,t){var n=this.indexOf(e,t);return n>=0&&e.splice(n,1),t},camelToDash:function(e){var t=/[A-Z]/g;return e.replace(t,function(e,t){return(t?"-":"")+e.toLowerCase()})},dashToCamel:function(e){var t=/([\:\-\_]+(.))/g,n=/^moz([A-Z])/;return e.replace(t,function(e,t,n,r){return r?n.toUpperCase():n}).replace(n,"Moz$1")}}}]),angular.module("xeditable").factory("editableNgOptionsParser",[function(){function e(e){var n;if(!(n=e.match(t)))throw"ng-options parse error";var r,a=n[2]||n[1],o=n[4]||n[6],i=n[5],s=(n[3]||"",n[2]?n[1]:o),l=n[7],u=n[8],c=u?n[8]:null;return void 0===i?(r=o+" in "+l,void 0!==u&&(r+=" track by "+c)):r="("+i+", "+o+") in "+l,{ngRepeat:r,locals:{valueName:o,keyName:i,valueFn:s,displayFn:a}}}var t=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e}]),angular.module("xeditable").factory("editableThemes",function(){var e={default:{formTpl:'<form class="editable-wrap"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<span class="editable-controls"></span>',inputTpl:"",errorTpl:'<div class="editable-error" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit">save</button>',cancelTpl:'<button type="button" ng-click="$form.$cancel()">cancel</button>'},bs2:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls controls control-group" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary"><span class="icon-ok icon-white"></span></button>',cancelTpl:'<button type="button" class="btn" ng-click="$form.$cancel()"><span class="icon-remove"></span></button>'
},bs3:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls form-group" ng-class="{\'has-error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-ok"></span></button>',cancelTpl:'<button type="button" class="btn btn-default" ng-click="$form.$cancel()"><span class="glyphicon glyphicon-remove"></span></button>',buttonsClass:"",inputClass:"",postrender:function(){switch(this.directiveName){case"editableText":case"editableSelect":case"editableTextarea":case"editableEmail":case"editableTel":case"editableNumber":case"editableUrl":case"editableSearch":case"editableDate":case"editableDatetime":case"editableTime":case"editableMonth":case"editableWeek":if(this.inputEl.addClass("form-control"),this.theme.inputClass){if(this.inputEl.attr("multiple")&&("input-sm"===this.theme.inputClass||"input-lg"===this.theme.inputClass))break;this.inputEl.addClass(this.theme.inputClass)}}this.buttonsEl&&this.theme.buttonsClass&&this.buttonsEl.find("button").addClass(this.theme.buttonsClass)}}};return e}),!function(e,t,n){"use strict";function r(e){return F(e)?e:Object.keys(e).map(function(t){return e[t]})}function a(e){return null===e}function o(e,t){var r=Object.keys(e);return-1==r.map(function(r){return t[r]!==n&&t[r]==e[r]}).indexOf(!1)}function i(e,t){if(""===t)return e;var n=e.indexOf(t.charAt(0));return-1!==n&&i(e.substr(n+1),t.substr(1))}function s(e,t,n){var r=0;return e.filter(function(e){var a=D(n)?t>r&&n(e):t>r;return r=a?r+1:r,a})}function l(e,t,n){return n.round(e*n.pow(10,t))/n.pow(10,t)}function u(e,t,n){t=t||[];var r=Object.keys(e);return r.forEach(function(r){if(T(e[r])&&!F(e[r])){var a=n?n+"."+r:n;u(e[r],t,a||r)}else{var o=n?n+"."+r:r;t.push(o)}}),t}function c(e){return e&&e.$evalAsync&&e.$watch}function d(){return function(e,t){return e>t}}function f(){return function(e,t){return e>=t}}function m(){return function(e,t){return t>e}}function p(){return function(e,t){return t>=e}}function b(){return function(e,t){return e==t}}function h(){return function(e,t){return e!=t}}function v(){return function(e,t){return e===t}}function g(){return function(e,t){return e!==t}}function _(e){return function(t,n){return t=T(t)?r(t):t,!(!F(t)||E(n))&&t.some(function(t){return T(t)||j(n)?e(n)(t):t===n})}}function $(e,t){return t=t||0,t>=e.length?e:F(e[t])?$(e.slice(0,t).concat(e[t],e.slice(t+1)),t):$(e,t+1)}function y(e){return function(t,n){function a(e,t){return!E(t)&&e.some(function(e){return N(e,t)})}if(t=T(t)?r(t):t,!F(t))return t;var o=[],i=e(n);return t.filter(E(n)?function(e,t,n){return n.indexOf(e)===t}:function(e){var t=i(e);return!a(o,t)&&(o.push(t),!0)})}}function w(e,t,n){return t?e+n+w(e,--t,n):e}var D=t.isDefined,E=t.isUndefined,j=t.isFunction,C=t.isString,R=t.isNumber,T=t.isObject,F=t.isArray,x=t.forEach,A=t.extend,S=t.copy,N=t.equals;String.prototype.contains||(String.prototype.contains=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),t.module("a8m.angular",[]).filter("isUndefined",function(){return function(e){return t.isUndefined(e)}}).filter("isDefined",function(){return function(e){return t.isDefined(e)}}).filter("isFunction",function(){return function(e){return t.isFunction(e)}}).filter("isString",function(){return function(e){return t.isString(e)}}).filter("isNumber",function(){return function(e){return t.isNumber(e)}}).filter("isArray",function(){return function(e){return t.isArray(e)}}).filter("isObject",function(){return function(e){return t.isObject(e)}}).filter("isEqual",function(){return function(e,n){return t.equals(e,n)}}),t.module("a8m.conditions",[]).filter({isGreaterThan:d,">":d,isGreaterThanOrEqualTo:f,">=":f,isLessThan:m,"<":m,isLessThanOrEqualTo:p,"<=":p,isEqualTo:b,"==":b,isNotEqualTo:h,"!=":h,isIdenticalTo:v,"===":v,isNotIdenticalTo:g,"!==":g}),t.module("a8m.is-null",[]).filter("isNull",function(){return function(e){return a(e)}}),t.module("a8m.after-where",[]).filter("afterWhere",function(){return function(e,t){if(e=T(e)?r(e):e,!F(e)||E(t))return e;var n=e.map(function(e){return o(t,e)}).indexOf(!0);return e.slice(-1===n?0:n)}}),t.module("a8m.after",[]).filter("after",function(){return function(e,t){return e=T(e)?r(e):e,F(e)?e.slice(t):e}}),t.module("a8m.before-where",[]).filter("beforeWhere",function(){return function(e,t){if(e=T(e)?r(e):e,!F(e)||E(t))return e;var n=e.map(function(e){return o(t,e)}).indexOf(!0);return e.slice(0,-1===n?e.length:++n)}}),t.module("a8m.before",[]).filter("before",function(){return function(e,t){return e=T(e)?r(e):e,F(e)?e.slice(0,t?--t:t):e}}),t.module("a8m.concat",[]).filter("concat",[function(){return function(e,t){if(E(t))return e;if(F(e))return e.concat(T(t)?r(t):t);if(T(e)){var n=r(e);return n.concat(T(t)?r(t):t)}return e}}]),t.module("a8m.contains",[]).filter({contains:["$parse",_],some:["$parse",_]}),t.module("a8m.count-by",[]).filter("countBy",["$parse",function(e){return function(t,n){var a,o={},i=e(n);return t=T(t)?r(t):t,!F(t)||E(n)?t:(t.forEach(function(e){a=i(e),o[a]||(o[a]=0),o[a]++}),o)}}]),t.module("a8m.defaults",[]).filter("defaults",["$parse",function(e){return function(t,n){if(t=T(t)?r(t):t,!F(t)||!T(n))return t;var a=u(n);return t.forEach(function(t){a.forEach(function(r){var a=e(r),o=a.assign;E(a(t))&&o(t,a(n))})}),t}}]),t.module("a8m.every",[]).filter("every",["$parse",function(e){return function(t,n){return t=T(t)?r(t):t,!(F(t)&&!E(n))||t.every(function(t){return T(t)||j(n)?e(n)(t):t===n})}}]),t.module("a8m.filter-by",[]).filter("filterBy",["$parse",function(e){return function(t,a,o){var i;return o=C(o)||R(o)?String(o).toLowerCase():n,t=T(t)?r(t):t,!F(t)||E(o)?t:t.filter(function(t){return a.some(function(n){if(~n.indexOf("+")){var r=n.replace(new RegExp("\\s","g"),"").split("+");i=r.reduce(function(n,r,a){return 1===a?e(n)(t)+" "+e(r)(t):n+" "+e(r)(t)})}else i=e(n)(t);return!(!C(i)&&!R(i))&&String(i).toLowerCase().contains(o)})})}}]),t.module("a8m.first",[]).filter("first",["$parse",function(e){return function(t){var a,o,i;return t=T(t)?r(t):t,F(t)?(i=Array.prototype.slice.call(arguments,1),a=R(i[0])?i[0]:1,o=R(i[0])?R(i[1])?n:i[1]:i[0],i.length?s(t,a,o?e(o):o):t[0]):t}}]),t.module("a8m.flatten",[]).filter("flatten",function(){return function(e,t){return t=t||!1,e=T(e)?r(e):e,F(e)?t?[].concat.apply([],e):$(e,0):e}}),t.module("a8m.fuzzy-by",[]).filter("fuzzyBy",["$parse",function(e){return function(t,n,a,o){var s,l,u=o||!1;return t=T(t)?r(t):t,!F(t)||E(n)||E(a)?t:(l=e(n),t.filter(function(e){return s=l(e),!!C(s)&&(s=u?s:s.toLowerCase(),a=u?a:a.toLowerCase(),i(s,a)!==!1)}))}}]),t.module("a8m.fuzzy",[]).filter("fuzzy",function(){return function(e,t,n){function a(e,t){var n,r,a=Object.keys(e);return 0<a.filter(function(a){return n=e[a],!!r||!!C(n)&&(n=o?n:n.toLowerCase(),r=i(n,t)!==!1)}).length}var o=n||!1;return e=T(e)?r(e):e,!F(e)||E(t)?e:(t=o?t:t.toLowerCase(),e.filter(function(e){return C(e)?(e=o?e:e.toLowerCase(),i(e,t)!==!1):!!T(e)&&a(e,t)}))}}),t.module("a8m.group-by",["a8m.filter-watcher"]).filter("groupBy",["$parse","filterWatcher",function(e,t){return function(n,r){function a(e,t){var n,r={};return x(e,function(e){n=t(e),r[n]||(r[n]=[]),r[n].push(e)}),r}if(!T(n)||E(r))return n;var o=e(r);return t.isMemoized("groupBy",arguments)||t.memoize("groupBy",arguments,this,a(n,o))}}]),t.module("a8m.is-empty",[]).filter("isEmpty",function(){return function(e){return T(e)?!r(e).length:!e.length}}),t.module("a8m.join",[]).filter("join",function(){return function(e,t){return E(e)||!F(e)?e:(E(t)&&(t=" "),e.join(t))}}),t.module("a8m.last",[]).filter("last",["$parse",function(e){return function(t){var a,o,i,l=S(t);return l=T(l)?r(l):l,F(l)?(i=Array.prototype.slice.call(arguments,1),a=R(i[0])?i[0]:1,o=R(i[0])?R(i[1])?n:i[1]:i[0],i.length?s(l.reverse(),a,o?e(o):o).reverse():l[l.length-1]):l}}]),t.module("a8m.map",[]).filter("map",["$parse",function(e){return function(t,n){return t=T(t)?r(t):t,!F(t)||E(n)?t:t.map(function(t){return e(n)(t)})}}]),t.module("a8m.omit",[]).filter("omit",["$parse",function(e){return function(t,n){return t=T(t)?r(t):t,!F(t)||E(n)?t:t.filter(function(t){return!e(n)(t)})}}]),t.module("a8m.pick",[]).filter("pick",["$parse",function(e){return function(t,n){return t=T(t)?r(t):t,!F(t)||E(n)?t:t.filter(function(t){return e(n)(t)})}}]),t.module("a8m.remove-with",[]).filter("removeWith",function(){return function(e,t){return E(t)?e:(e=T(e)?r(e):e,e.filter(function(e){return!o(t,e)}))}}),t.module("a8m.remove",[]).filter("remove",function(){return function(e){e=T(e)?r(e):e;var t=Array.prototype.slice.call(arguments,1);return F(e)?e.filter(function(e){return!t.some(function(t){return N(t,e)})}):e}}),t.module("a8m.reverse",[]).filter("reverse",[function(){return function(e){return e=T(e)?r(e):e,C(e)?e.split("").reverse().join(""):F(e)?e.slice().reverse():e}}]),t.module("a8m.search-field",[]).filter("searchField",["$parse",function(e){return function(t){var n,a;t=T(t)?r(t):t;var o=Array.prototype.slice.call(arguments,1);return F(t)&&o.length?t.map(function(t){return a=o.map(function(r){return(n=e(r))(t)}).join(" "),A(t,{searchField:a})}):t}}]),t.module("a8m.to-array",[]).filter("toArray",function(){return function(e,t){return T(e)?t?Object.keys(e).map(function(t){return A(e[t],{$key:t})}):r(e):e}}),t.module("a8m.unique",[]).filter({unique:["$parse",y],uniq:["$parse",y]}),t.module("a8m.where",[]).filter("where",function(){return function(e,t){return E(t)?e:(e=T(e)?r(e):e,e.filter(function(e){return o(t,e)}))}}),t.module("a8m.xor",[]).filter("xor",["$parse",function(e){return function(t,n,a){function o(t,n){var r=e(a);return n.some(function(e){return a?N(r(e),r(t)):N(e,t)})}return a=a||!1,t=T(t)?r(t):t,n=T(n)?r(n):n,F(t)&&F(n)?t.concat(n).filter(function(e){return!(o(e,t)&&o(e,n))}):t}}]),t.module("a8m.math.byteFmt",["a8m.math"]).filter("byteFmt",["$math",function(e){return function(t,n){return R(n)&&isFinite(n)&&n%1===0&&n>=0&&R(t)&&isFinite(t)?1024>t?l(t,n,e)+" B":1048576>t?l(t/1024,n,e)+" KB":1073741824>t?l(t/1048576,n,e)+" MB":l(t/1073741824,n,e)+" GB":"NaN"}}]),t.module("a8m.math.degrees",["a8m.math"]).filter("degrees",["$math",function(e){return function(t,n){if(R(n)&&isFinite(n)&&n%1===0&&n>=0&&R(t)&&isFinite(t)){var r=180*t/e.PI;return e.round(r*e.pow(10,n))/e.pow(10,n)}return"NaN"}}]),t.module("a8m.math.kbFmt",["a8m.math"]).filter("kbFmt",["$math",function(e){return function(t,n){return R(n)&&isFinite(n)&&n%1===0&&n>=0&&R(t)&&isFinite(t)?1024>t?l(t,n,e)+" KB":1048576>t?l(t/1024,n,e)+" MB":l(t/1048576,n,e)+" GB":"NaN"}}]),t.module("a8m.math",[]).factory("$math",["$window",function(e){return e.Math}]),t.module("a8m.math.max",["a8m.math"]).filter("max",["$math","$parse",function(e,t){function n(n,r){var a=n.map(function(e){return t(r)(e)});return a.indexOf(e.max.apply(e,a))}return function(t,r){return F(t)?E(r)?e.max.apply(e,t):t[n(t,r)]:t}}]),t.module("a8m.math.min",["a8m.math"]).filter("min",["$math","$parse",function(e,t){function n(n,r){var a=n.map(function(e){return t(r)(e)});return a.indexOf(e.min.apply(e,a))}return function(t,r){return F(t)?E(r)?e.min.apply(e,t):t[n(t,r)]:t}}]),t.module("a8m.math.percent",["a8m.math"]).filter("percent",["$math","$window",function(e,t){return function(n,r,a){var o=C(n)?t.Number(n):n;return r=r||100,a=a||!1,!R(o)||t.isNaN(o)?n:a?e.round(o/r*100):o/r*100}}]),t.module("a8m.math.radians",["a8m.math"]).filter("radians",["$math",function(e){return function(t,n){if(R(n)&&isFinite(n)&&n%1===0&&n>=0&&R(t)&&isFinite(t)){var r=3.14159265359*t/180;return e.round(r*e.pow(10,n))/e.pow(10,n)}return"NaN"}}]),t.module("a8m.math.radix",[]).filter("radix",function(){return function(e,t){var n=/^[2-9]$|^[1-2]\d$|^3[0-6]$/;return R(e)&&n.test(t)?e.toString(t).toUpperCase():e}}),t.module("a8m.math.shortFmt",["a8m.math"]).filter("shortFmt",["$math",function(e){return function(t,n){return R(n)&&isFinite(n)&&n%1===0&&n>=0&&R(t)&&isFinite(t)?1e3>t?t:1e6>t?l(t/1e3,n,e)+" K":1e9>t?l(t/1e6,n,e)+" M":l(t/1e9,n,e)+" B":"NaN"}}]),t.module("a8m.math.sum",[]).filter("sum",function(){return function(e,t){return F(e)?e.reduce(function(e,t){return e+t},t||0):e}}),t.module("a8m.ends-with",[]).filter("endsWith",function(){return function(e,t,n){var r,a=n||!1;return!C(e)||E(t)?e:(e=a?e:e.toLowerCase(),r=e.length-t.length,-1!==e.indexOf(a?t:t.toLowerCase(),r))}}),t.module("a8m.latinize",[]).filter("latinize",[function(){function e(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return n[e]||e})}for(var t=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],n={},r=0;r<t.length;r++)for(var a=t[r].letters.split(""),o=0;o<a.length;o++)n[a[o]]=t[r].base;return function(t){return C(t)?e(t):t}}]),t.module("a8m.ltrim",[]).filter("ltrim",function(){return function(e,t){var n=t||"\\s";return C(e)?e.replace(new RegExp("^"+n+"+"),""):e}}),t.module("a8m.match",[]).filter("match",function(){return function(e,t,n){var r=new RegExp(t,n);return C(e)?e.match(r):null}}),t.module("a8m.repeat",[]).filter("repeat",[function(){return function(e,t,n){var r=~~t;return C(e)&&r?w(e,--t,n||""):e}}]),t.module("a8m.rtrim",[]).filter("rtrim",function(){return function(e,t){var n=t||"\\s";return C(e)?e.replace(new RegExp(n+"+$"),""):e}}),t.module("a8m.slugify",[]).filter("slugify",[function(){return function(e,t){var n=E(t)?"-":t;return C(e)?e.toLowerCase().replace(/\s+/g,n):e}}]),t.module("a8m.starts-with",[]).filter("startsWith",function(){return function(e,t,n){var r=n||!1;return!C(e)||E(t)?e:(e=r?e:e.toLowerCase(),!e.indexOf(r?t:t.toLowerCase()))}}),t.module("a8m.stringular",[]).filter("stringular",function(){return function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return E(t[n])?e:t[n]})}}),t.module("a8m.strip-tags",[]).filter("stripTags",function(){return function(e){return C(e)?e.replace(/<\S[^><]*>/g,""):e}}),t.module("a8m.test",[]).filter("test",function(){return function(e,t,n){var r=new RegExp(t,n);return C(e)?r.test(e):e}}),t.module("a8m.trim",[]).filter("trim",function(){return function(e,t){var n=t||"\\s";return C(e)?e.replace(new RegExp("^"+n+"+|"+n+"+$","g"),""):e}}),t.module("a8m.truncate",[]).filter("truncate",function(){return function(e,t,n,r){return t=E(t)?e.length:t,r=r||!1,n=n||"",!C(e)||e.length<=t?e:e.substring(0,r?-1===e.indexOf(" ",t)?e.length:e.indexOf(" ",t):t)+n}}),t.module("a8m.ucfirst",[]).filter("ucfirst",[function(){return function(e){return C(e)?e.split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substring(1)}).join(" "):e}}]),t.module("a8m.uri-component-encode",[]).filter("uriComponentEncode",["$window",function(e){return function(t){return C(t)?e.encodeURIComponent(t):t}}]),t.module("a8m.uri-encode",[]).filter("uriEncode",["$window",function(e){return function(t){return C(t)?e.encodeURI(t):t}}]),t.module("a8m.wrap",[]).filter("wrap",function(){return function(e,t,n){return C(e)&&D(t)?[t,e,n||t].join(""):e}}),t.module("a8m.filter-watcher",[]).provider("filterWatcher",function(){this.$get=["$window","$rootScope",function(e,n){function r(e,n){return[e,t.toJson(n)].join("#").replace(/"/g,"")}function a(e){var t=e.targetScope.$id;x(d[t],function(e){delete u[e]}),delete d[t]}function o(){f(function(){n.$$phase||(u={})})}function i(e,t){var n=e.$id;return E(d[n])&&(e.$on("$destroy",a),d[n]=[]),d[n].push(t)}function s(e,t){var n=r(e,t);return u[n]}function l(e,t,n,a){var s=r(e,t);return u[s]=a,c(n)?i(n,s):o(),a}var u={},d={},f=e.setTimeout;return{isMemoized:s,memoize:l}}]}),t.module("angular.filter",["a8m.ucfirst","a8m.uri-encode","a8m.uri-component-encode","a8m.slugify","a8m.latinize","a8m.strip-tags","a8m.stringular","a8m.truncate","a8m.starts-with","a8m.ends-with","a8m.wrap","a8m.trim","a8m.ltrim","a8m.rtrim","a8m.repeat","a8m.test","a8m.match","a8m.to-array","a8m.concat","a8m.contains","a8m.unique","a8m.is-empty","a8m.after","a8m.after-where","a8m.before","a8m.before-where","a8m.defaults","a8m.where","a8m.reverse","a8m.remove","a8m.remove-with","a8m.group-by","a8m.count-by","a8m.search-field","a8m.fuzzy-by","a8m.fuzzy","a8m.omit","a8m.pick","a8m.every","a8m.filter-by","a8m.xor","a8m.map","a8m.first","a8m.last","a8m.flatten","a8m.join","a8m.math","a8m.math.max","a8m.math.min","a8m.math.percent","a8m.math.radix","a8m.math.sum","a8m.math.degrees","a8m.math.radians","a8m.math.byteFmt","a8m.math.kbFmt","a8m.math.shortFmt","a8m.angular","a8m.conditions","a8m.is-null","a8m.filter-watcher"])}(window,window.angular),define("job-roles/modules/job-roles.core",["common/angular","common/ui-select","common/directives/angular-date/date-input","common/modules/directives","common/modules/routers/compu-ng-route","common/filters/angular-date/format-date","common/services/angular-date/date-format","common/services/dom-event-trigger","common/services/pub-sub","job-roles/vendor/angular-editable","job-roles/vendor/angular-filter"],function(e){"use strict";e.module("hrjobroles.core",["angular.filter","ngAnimate","ngSanitize","ngResource","ui.bootstrap","ui.select","xeditable","common.angularDate","common.directives","common.services","compuNgRoute"])}),define("job-roles/filters/get-active-values.filter",["common/lodash"],function(e){"use strict";function t(t){return t.debug("Filter: getActiveValues"),function(t){var n={};return e.each(t,function(e,t){"1"===e.is_active&&(n[t]=e)}),n}}return t.__name="getActiveValues",t.$inject=["$log"],t}),define("job-roles/modules/job-roles.filters",["common/angular","job-roles/filters/get-active-values.filter"],function(e,t){"use strict";return e.module("hrjobroles.filters",[]).filter(t.__name,t)}),define("job-roles/modules/job-roles.run",["common/angular"],function(e){"use strict";function t(e,t,n,r){n.theme="bs3",t.contactId=r.contactId,t.pathBaseUrl=r.pathBaseUrl,t.pathTpl=r.pathTpl,t.pathIncludeTpl=r.pathIncludeTpl,t.prefix=r.classNamePrefix}e.module("hrjobroles.run",["hrjobroles.constants"]).run(t),t.$inject=["$q","$rootScope","editableOptions","settings"]}),define("job-roles/services/date-validation.service",["common/moment"],function(e){function t(t){function n(e,t){e.isValid()||l("Date is not valid!!",t)}function r(e,t){e.isSameOrAfter(t)&&l("Start Date cannot be the same as or after the End Date.",["start_date","end_date"])}function a(e,t){e.isBefore(t)&&l("Start Date cannot be lower than Contract Start Date.",["start_date"])}function o(e,t){e.isAfter(t)&&l("Start Date cannot be higher than Contract End Date.",["start_date"])}function i(e,t){e.isAfter(t)&&l("End Date cannot be higher than Contract End Date.",["end_date"])}function s(t,n){return t instanceof Date&&(t=e(t).valueOf()),e(t,n,!0).startOf("day")}var l=function(e,t){throw new Error(e,t[0])},u={dateFormats:["x","YYYY-MM-DD"],setErrorCallback:function(e){if("function"!=typeof e)throw new TypeError("Error callback must be a function.");l=e},validate:function(e,t,l,u){e=s(e,this.dateFormats),l=s(l,this.dateFormats),u=s(u,this.dateFormats),n(e,["start_date"]),o(e,u),a(e,l),(0===t||t)&&(t=s(t,this.dateFormats),n(t,["end_date"]),i(t,u),r(e,t))}};return t.DATE_FORMAT&&u.dateFormats.push(t.DATE_FORMAT.toUpperCase()),u}return t.__name="dateValidation",t.$inject=["HR_settings"],t}),define("job-roles/services/filters.service",[],function(){"use strict";function e(){return{isNotUndefined:function(e){try{return e.constructor===Array?e.filter(function(e){return"undefined"!==e&&void 0!==e}):e}catch(t){return e}},issetCostCentre:function(e){try{return e.constructor===Array?e.filter(function(e){return""!==e.cost_centre_id&&("1"===e.type&&parseInt(e.percentage)>0||"0"===e.type&&parseInt(e.amount)>0)}):e}catch(t){return e}},issetFunder:function(e){try{return e.constructor===Array?e.filter(function(e){return""!==e.funder_id&&("1"===e.type&&parseInt(e.percentage)>0||"0"===e.type&&parseInt(e.amount)>0)}):e}catch(t){return e}}}}return e.__name="filtersService",e}),define("job-roles/services/job-role.service",["common/lodash"],function(e){"use strict";function t(t,n,r){function a(n){var r=n["api.HRJobContractRevision.get"].values;delete n["api.HRJobContractRevision.get"],n.revisions=e.compact(r.map(function(e){var r=e["api.HRJobDetails.getsingle"];return r.period_start_date===n.period_start_date&&r.period_end_date===n.period_end_date?null:(r.period_start_date=t("formatDate")(r.period_start_date),r.period_end_date=t("formatDate")(r.period_end_date),r)}))}return{getContracts:function(e){var t=r.defer();return CRM.api3("HRJobContract","get",{sequential:1,contact_id:e,deleted:0,return:"title,period_end_date,period_start_date","api.HRJobContractRevision.get":{jobcontract_id:"$value.id","api.HRJobDetails.getsingle":{jobcontract_revision_id:"$value.id"}}}).done(function(e){e.values.forEach(a),t.resolve(e)}).error(function(){t.reject("An error occured while fetching items")}),t.promise},getAllJobRoles:function(e){var t=r.defer();return CRM.api3("HrJobRoles","get",{sequential:1,return:"id,job_contract_id,title,description,status,funder,funder_val_type,percent_pay_funder,amount_pay_funder,cost_center,cost_center_val_type,percent_pay_cost_center,amount_pay_cost_center,level_type,location,region,department,end_date,start_date",job_contract_id:{IN:e}}).done(function(e){t.resolve(e)}).error(function(e){t.reject("An error occured while fetching items")}),t.promise},deleteJobRole:function(e){var t=r.defer();return CRM.api3("HrJobRoles","delete",{sequential:1,id:e}).done(function(e){t.resolve(e)}).error(function(e){t.reject("An error occured while deleting items")}),t.promise},createJobRole:function(e){var t="|",n="|",a="|",o="|",i="|",s="|",l="|",u="|";if("undefined"!=typeof e.funders)for(var c=0,d=e.funders.length;c<d;c++)e.funders[c]&&(t+=e.funders[c].funder_id.id+"|",n+=e.funders[c].type+"|",a+=e.funders[c].percentage+"|",o+=e.funders[c].amount+"|");if("undefined"!=typeof e.cost_centers)for(c=0,d=e.cost_centers.length;c<d;c++)e.cost_centers[c]&&(i+=e.cost_centers[c].cost_centre_id+"|",s+=e.cost_centers[c].type+"|",l+=e.cost_centers[c].percentage+"|",u+=e.cost_centers[c].amount+"|");var f=r.defer();return this.getNewJobRole(e.job_contract_id).then(function(r){return CRM.api3("HrJobRoles","update",{id:r.id,sequential:1,job_contract_id:e.job_contract_id,title:e.title,description:e.description,funder:t,funder_val_type:n,percent_pay_funder:a,amount_pay_funder:o,cost_center:i,cost_center_val_type:s,percent_pay_cost_center:l,amount_pay_cost_center:u,level_type:e.level,location:e.location,region:e.region,department:e.department,start_date:e.newStartDate,end_date:e.newEndDate||null})}).then(function(e){f.resolve(e)},function(e){f.reject("An error occured while adding items")}),f.promise},updateJobRole:function(e,t){var n="|",a="|",o="|",i="|",s="|",l="|",u="|",c="|";if("undefined"!=typeof t.funders)for(var d=0,f=t.funders.length;d<f;d++)t.funders[d]&&(n+=t.funders[d].funder_id.id+"|",a+=t.funders[d].type+"|",o+=t.funders[d].percentage+"|",i+=t.funders[d].amount+"|");if("undefined"!=typeof t.cost_centers)for(d=0,f=t.cost_centers.length;d<f;d++)t.cost_centers[d]&&(s+=t.cost_centers[d].cost_centre_id+"|",l+=t.cost_centers[d].type+"|",u+=t.cost_centers[d].percentage+"|",c+=t.cost_centers[d].amount+"|");var m=r.defer();return CRM.api3("HrJobRoles","create",{sequential:1,id:e,job_contract_id:t.job_contract_id,title:t.title,description:t.description,status:t.status,funder:n,funder_val_type:a,percent_pay_funder:o,amount_pay_funder:i,cost_center:s,cost_center_val_type:l,percent_pay_cost_center:u,amount_pay_cost_center:c,level_type:t.level,location:t.location,region:t.region,start_date:t.start_date,end_date:t.end_date||0,department:t.department}).done(function(e){m.resolve(e)}).error(function(e){m.reject("An error occured while updating items")}),m.promise},getContactList:function(t,n){var a=r.defer();return CRM.api3("Contact","get",{sequential:1,return:"id, sort_name",id:e.isArray(n)?{IN:n}:null,sort_name:t||null}).done(function(e){a.resolve(e)}).error(function(e){a.reject("An error occured while fetching items")}),a.promise},getOptionValues:function(t){var n=r.defer();return CRM.api3("OptionValue","get",{sequential:1,"option_group_id.name":{IN:t},return:["id","label","weight","value","is_active","option_group_id","option_group_id.name"],options:{limit:1e3,sort:"id"}}).done(function(t){t.optionGroupData=e(t.values).map(function(e){return[e["option_group_id.name"],e.option_group_id]}).zipObject().value(),n.resolve(t)}).error(function(e){n.reject("An error occured while fetching items")}),n.promise},getNewJobRole:function(e){return CRM.api3("HrJobRoles","create",{sequential:1,job_contract_id:e,title:""})},getCurrentDepartments:function(e){return CRM.api3("HrJobRoles","getcurrentdepartments",{sequential:1,job_contract_id:e}).then(function(e){return e.values})}}}return t.__name="jobRoleService",t.$inject=["$filter","$log","$q"],t}),define("job-roles/modules/job-roles.services",["common/angular","job-roles/services/date-validation.service","job-roles/services/filters.service","job-roles/services/job-role.service"],function(e,t,n,r){"use strict";return e.module("hrjobroles.services",[]).factory(t.__name,t).factory(n.__name,n).factory(r.__name,r)}),define("job-roles/modules/job-roles.module",["common/angular","job-roles/modules/job-roles.config","job-roles/modules/job-roles.constants","job-roles/modules/job-roles.controllers","job-roles/modules/job-roles.core","job-roles/modules/job-roles.filters","job-roles/modules/job-roles.run","job-roles/modules/job-roles.services"],function(e){"use strict";e.module("hrjobroles",["hrjobroles.core","hrjobroles.config","hrjobroles.run","hrjobroles.constants","hrjobroles.controllers","hrjobroles.filters","hrjobroles.services"])}),function(e,t){var n=e.vars.hrjobroles.baseURL+"/js/src/job-roles";t.config({urlArgs:"bust="+(new Date).getTime(),paths:{"job-roles":n,"job-roles/vendor/angular-editable":n+"/vendor/angular/xeditable.min","job-roles/vendor/angular-filter":n+"/vendor/angular/angular-filter.min"}}),t(["job-roles/modules/job-roles.module"],function(e){"use strict";document.dispatchEvent("function"==typeof window.CustomEvent?new CustomEvent("hrjobrolesReady"):function(){var e=document.createEvent("Event");return e.initEvent("hrjobrolesReady",!0,!0),e}())})}(CRM,require);